<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conference</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Conference Registration</h1>
        <form id="mainForm">
            <input type="text" id="name" placeholder="Full Name">
            <div id="nameError" class="error"></div>

            <input type="text" id="clgName" placeholder="College Name">
            <div id="clgNameError" class="error"></div>

            <input type="text" id="department" placeholder="Department (Abbreviation)">
            <div id="departmentError" class="error"></div>

            <select id="year">
                <option value="">Select Year</option>
                <option value="1">1st Year</option>
                <option value="2">2nd Year</option>
                <option value="3">3rd Year</option>
                <option value="4">4th Year</option>
            </select>
            <div id="yearError" class="error"></div>

            <input type="email" id="email" placeholder="Email ID">
            <div id="emailError" class="error"></div>

            <input type="tel" id="phoneNumber" placeholder="Phone Number">
            <div id="phoneNumberError" class="error"></div>

            <select id="participationType">
                <option value="">Select Participation Type</option>
                <option value="Presentation">Presentation</option>
                <option value="Participation">Participation</option>
            </select>
            <div id="participationTypeError" class="error"></div>

            <button type="button" id="nextButton">Next</button>
        </form>
        <div id="overlay" class="overlay">
            <div class="loading">
                <div class="loading-spinner"></div>
                <span class="loading-text">Submitting...</span>
            </div>
        </div>
        <form id="presentationForm" style="display: none;">
            <h2>Presentation Details</h2>
            <input type="text" id="upiId" placeholder="UPI ID">
            <div id="upiIdError" class="error"></div>

            <input type="url" id="presentationScreenshot" placeholder="UPI Transaction Screenshot (Google Drive URL)">
            <div id="presentationScreenshotError" class="error"></div>

            <button type="button" id="submitPresentation">Submit</button>
        </form>
        <form id="participationForm" style="display: none;">
            <h2>Participation Details</h2>
            <select id="domain">
                <option value="">Select Domain</option>
                <option value="Communication and Networking">Communication and Networking</option>
                <option value="Database Systems, Data Warehousing, and Data Mining">Database Systems, Data Warehousing, and Data Mining</option>
                <option value="Information Assurance">Information Assurance</option>
            </select>
            <div id="domainError" class="error"></div>

            <input type="text" id="title" placeholder="Title">
            <div id="titleError" class="error"></div>

            <input type="url" id="paperAttachment" placeholder="Paper Attachment (Google Drive URL)">
            <div id="paperAttachmentError" class="error"></div>

            <input type="text" id="teamMembers" placeholder="Team Members Details">
            <div id="teamMembersError" class="error"></div>

            <button type="button" id="submitParticipation">Submit</button>
        </form>

        <div id="successMessage" style="display: none;">
            <p>Registration Successful!</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDuuumZaf2vqFA3ezY_eq98Pq7qQIDTe0Q",
            authDomain: "kkrt-8726d.firebaseapp.com",
            projectId: "kkrt-8726d",
            storageBucket: "kkrt-8726d.firebasestorage.app",
            messagingSenderId: "775944666621",
            appId: "1:775944666621:web:180754cc4a130108372d94",
            measurementId: "G-BT8TZ60JGR"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const resetErrors = () => {
            document.querySelectorAll('.error').forEach(err => err.innerText = '');
        };

        const validateForm = (formFields) => {
            let isValid = true;
            formFields.forEach(({ id, errorId, message }) => {
                const value = document.getElementById(id).value.trim();
                if (!value) {
                    document.getElementById(errorId).innerText = message;
                    isValid = false;
                } else {
                    document.getElementById(errorId).innerText = '';
                }
            });
            return isValid;
        };
        const saveToFirestore = async (userDetails) => {
            try {
                document.getElementById("overlay").style.display = "block"; // Show loading
                const docRef = await addDoc(collection(db, "userDetails"), userDetails);
                console.log("Document written with ID: ", docRef.id);
                document.getElementById("overlay").style.display = "none"; // Hide loading
                document.getElementById("successMessage").style.display = "block";
                setTimeout(() => {
                    document.getElementById("successMessage").style.display = "none";
                    location.reload();
                }, 3000);
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        };
        document.getElementById("nextButton").addEventListener("click", () => {
            resetErrors();
            const mainFormFields = [
                { id: "name", errorId: "nameError", message: "Name is required." },
                { id: "clgName", errorId: "clgNameError", message: "College name is required." },
                { id: "department", errorId: "departmentError", message: "Department is required." },
                { id: "year", errorId: "yearError", message: "Year is required." },
                { id: "email", errorId: "emailError", message: "Email is required." },
                { id: "phoneNumber", errorId: "phoneNumberError", message: "Phone number is required." },
                { id: "participationType", errorId: "participationTypeError", message: "Participation type is required." }
            ];
            if (validateForm(mainFormFields)) {
                const participationType = document.getElementById("participationType").value;
                document.getElementById("mainForm").style.display = "none";
                if (participationType === "Presentation") {
                    document.getElementById("presentationForm").style.display = "block";
                } else if (participationType === "Participation") {
                    document.getElementById("participationForm").style.display = "block";
                }
            }
        });

        document.getElementById("submitPresentation").addEventListener("click", () => {
            resetErrors();
            const presentationFields = [
                { id: "upiId", errorId: "upiIdError", message: "UPI ID is required." },
                { id: "presentationScreenshot", errorId: "presentationScreenshotError", message: "UPI screenshot is required." }
            ];
            if (validateForm(presentationFields)) {
                const userDetails = {
                    name: document.getElementById("name").value,
                    clgName: document.getElementById("clgName").value,
                    department: document.getElementById("department").value,
                    year: document.getElementById("year").value,
                    email: document.getElementById("email").value,
                    phoneNumber: document.getElementById("phoneNumber").value,
                    participationType: "Presentation",
                    upiId: document.getElementById("upiId").value,
                    presentationScreenshot: document.getElementById("presentationScreenshot").value,
                    timestamp: serverTimestamp()
                };
                saveToFirestore(userDetails);
            }
        });
        document.getElementById("submitParticipation").addEventListener("click", () => {
            resetErrors();
            const participationFields = [
                { id: "domain", errorId: "domainError", message: "Domain is required." },
                { id: "title", errorId: "titleError", message: "Title is required." },
                { id: "paperAttachment", errorId: "paperAttachmentError", message: "Paper attachment is required." },
                { id: "teamMembers", errorId: "teamMembersError", message: "Team members are required." }
            ];
            if (validateForm(participationFields)) {
                const userDetails = {
                    name: document.getElementById("name").value,
                    clgName: document.getElementById("clgName").value,
                    department: document.getElementById("department").value,
                    year: document.getElementById("year").value,
                    email: document.getElementById("email").value,
                    phoneNumber: document.getElementById("phoneNumber").value,
                    participationType: "Participation",
                    domain: document.getElementById("domain").value,
                    title: document.getElementById("title").value,
                    paperAttachment: document.getElementById("paperAttachment").value,
                    teamMembers: document.getElementById("teamMembers").value,
                    timestamp: serverTimestamp()
                };
                saveToFirestore(userDetails);
            }
        });
    </script>
</body>
</html>
